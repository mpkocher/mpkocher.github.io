<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Archive: 2019/9
  
</title>

<meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://mpkocher.github.io/archives/2019/09/index.html">
<meta property="og:site_name">
<meta property="og:locale" content="en_US">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@https:&#x2F;&#x2F;twitter.com&#x2F;ElevenPhonons">


  <link rel="alternative" href="/atom.xml" title="" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">



<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">


<link rel="stylesheet" href="/styles/main.css">



  <!-- Google Analytics -->
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-141397134-1', 'auto');
    ga('send', 'pageview');

  </script>
  <!-- End Google Analytics -->





<meta name="generator" content="Hexo 6.2.0"></head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/"></a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/"></a></h1>
    
    <div class="info">
      <div class="content">
        
        
      </div>
      
        <div class="avatar">
          
            <a href="/2017/09/04/About"><img src="https://avatars3.githubusercontent.com/u/868552?v=4&amp;s=460"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/FPT/" rel="tag">FPT</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/functional/" rel="tag">functional</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lbl/" rel="tag">lbl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/materials-project/" rel="tag">materials-project</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mypy/" rel="tag">mypy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pacbio/" rel="tag">pacbio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/" rel="tag">scala</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala-cli/" rel="tag">scala-cli</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/series/" rel="tag">series</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zio/" rel="tag">zio</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">3</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage" external="false">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year" external="false">By Year</a>
              </li>
            
          
            
              <li>
                <a href="/2019/03/01/Functional-Programming-Techniques-In-Python-Series/" title="Functional Programming Techniques in Python" external="false">Functional Programming Techniques in Python</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/2017/09/04/About/" title="About" external="false">About</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/mpkocher/cv/blob/master/academic/cv.pdf" title="CV" target="_blank" rel="noopener">CV</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/mpkocher" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
            
              <li>
                <a href="https://gist.github.com/mpkocher" title="Gists" target="_blank" rel="noopener">Gists</a>
              </li>
            
          
            
              <li>
                <a href="https://www.linkedin.com/in/michael-kocher-b4bba5122/" title="LinkedIn" target="_blank" rel="noopener">LinkedIn</a>
              </li>
            
          
            
              <li>
                <a href="https://twitter.com/ElevenPhonons" title="Twitter" target="_blank" rel="noopener">Twitter</a>
              </li>
            
          
            
              <li>
                <a href="/2017/09/04/Now" title="Now" external="false">Now</a>
              </li>
            
          
            
              <li>
                <a href="/atom.xml" title="RSS" external="false">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    
      
      
      <section class="archives-wrap">
        <div class="archive-year-wrap">
          <h1><a href="/archives/2019" class="archive-year">2019</a></h1>
        </div>
        <div class="post-list">
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/09/19/Exploring-TypedDict-in-Python-3-8/" >
  Exploring TypedDict in Python 3.8
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/09/19/Exploring-TypedDict-in-Python-3-8/"><span class="article-date">
  2019-09-19
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mypy/" rel="tag">mypy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>This post will explore the new <code>TypedDict</code> feature in Python and explore leveraging <code>TypedDict</code> combined with the static analysis tool <a target="_blank" rel="noopener" href="https://github.com/python/mypy"><code>mypy</code></a> to improve the robustness of your Python code.</p>
<h2 id="PEP-589"><a href="#PEP-589" class="headerlink" title="PEP-589"></a>PEP-589</h2><p><code>TypedDict</code> was proposed in <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0589/">PEP-589</a> and accepted in Python 3.8.</p>
<p>A few key quotes from PEP-589 can provide context and motivation for the problem that <code>TypedDict</code> is attempting to address.</p>
<blockquote>
<p>This PEP proposes a type constructor typing.TypedDict to support the use case where a dictionary object has a specific set of string keys, each with a value of a specific type.</p>
</blockquote>
<blockquote>
<p>More generally, representing pure data objects using only Python primitive types such as dictionaries, strings and lists has had certain appeal. They are are easy to serialize and deserialize even when not using JSON. They trivially support various useful operations with no extra effort, including pretty-printing (through str() and the pprint module), iteration, and equality comparisons.</p>
</blockquote>
<p>This particular section of the PEP is interesting and suggests that <code>TypedDict</code> can be particularly useful for retrofitting legacy code (with type annotations). </p>
<blockquote>
<p>Dataclasses are a more recent alternative to solve this use case, but there is still a lot of existing code that was written before dataclasses became available, especially in large existing codebases where type hinting and checking has proven to be helpful. Unlike dictionary objects, dataclasses don’t directly support JSON serialization, though there is a third-party package that implements it</p>
</blockquote>
<p>The reference implementation was defined in <a target="_blank" rel="noopener" href="https://github.com/python/mypy_extensions">mypy_extensions</a> and can be installed in Python 3.7 (e.g., <code>pip install mypy_extensions</code>), or using <code>typing.TypedDict</code> in Python 3.8. </p>
<p>These following examples are run with <code>mypy</code> 0.711 and examples shown below can be obtained from <a target="_blank" rel="noopener" href="https://gist.github.com/mpkocher/e123aa0613242715717d291f9df7afdd">this gist</a>.</p>
<h2 id="Motivation-Dictionary-Mania"><a href="#Motivation-Dictionary-Mania" class="headerlink" title="Motivation: Dictionary-Mania"></a>Motivation: Dictionary-Mania</h2><p>Here’s a common example where a type-checking tool (e.g., <code>mypy</code>) won’t be able to help you catch type errors in your code.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">example_0</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Simple Example of Using raw dict and how mypy won&#x27;t catch</span></span><br><span class="line"><span class="string">    these errors with the keys</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    m = <span class="built_in">dict</span>(name=<span class="string">&#x27;Star Wars&#x27;</span>, year=<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># mypy will NOT catch this error</span></span><br><span class="line">    t = m[<span class="string">&#x27;name&#x27;</span>] + <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>However, with <code>TypedDict</code>, you can define this a structural-typing-ish interface to <code>dict</code> for a specific data model.</p>
<p>Using Python &lt; 3.8 will require <code>from mypy_extensions import TypedDict</code> whereas, Python &gt;&#x3D; 3.8 will require <code>from typing import TypedDict</code>.</p>
<p>Let’s create a simple <code>Movie</code> data model example and explore how <code>mypy</code> can be used to help catch type errors.</p>
<h2 id="Example-1-Basic-Usage-of-TypedDict"><a href="#Example-1-Basic-Usage-of-TypedDict" class="headerlink" title="Example 1: Basic Usage of TypedDict"></a>Example 1: Basic Usage of TypedDict</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Movie</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    year: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example_01</span>():</span><br><span class="line">    m = Movie(name=<span class="string">&#x27;Star Wars&#x27;</span>, year=<span class="number">1977</span>)</span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    m2:Movie = <span class="built_in">dict</span>(name=<span class="string">&#x27;Star Wars&#x27;</span>, year=<span class="number">1977</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the type checker will catch this</span></span><br><span class="line">    n = m[<span class="string">&#x27;name&#x27;</span>] + <span class="number">100</span></span><br></pre></td></tr></table></figure>


<p>To enable runnable code that <strong>purposely has errors</strong> that can be caught by <code>mypy</code>, let’s define a helper function to require a specific <code>Exception</code> type to be raised. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">log = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_expected_error</span>(<span class="params">ex, fx</span>):</span><br><span class="line">    raised_error = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> fx()</span><br><span class="line">    <span class="keyword">except</span> ex <span class="keyword">as</span> e:</span><br><span class="line">        raised_error = <span class="literal">True</span></span><br><span class="line">        log.info(<span class="string">f&quot;Got Expected error `<span class="subst">&#123;e&#125;</span>` of type <span class="subst">&#123;ex&#125;</span> from <span class="subst">&#123;fx.__name__&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> raised_error:</span><br><span class="line">            log.error(<span class="string">f&quot;Expected <span class="subst">&#123;fx&#125;</span> to raise <span class="subst">&#123;ex&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Example-2-Exploring-Mutating-and-Assignment-of-TypedDicts"><a href="#Example-2-Exploring-Mutating-and-Assignment-of-TypedDicts" class="headerlink" title="Example 2: Exploring Mutating and Assignment of TypedDicts"></a>Example 2: Exploring Mutating and Assignment of TypedDicts</h2><p>Let’s mutate the <code>Movie</code> <code>TypedDict</code> instance and explore how <code>mypy</code> can catch type errors during assignment.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">example_02</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    m = Movie(name=<span class="string">&#x27;Star Wars&#x27;</span>, year=<span class="number">1977</span>)</span><br><span class="line">    log.info(m)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># mypy will catch this</span></span><br><span class="line">    m[<span class="string">&#x27;name&#x27;</span>] = <span class="number">11111</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        m[<span class="string">&#x27;year&#x27;</span>] = m[<span class="string">&#x27;year&#x27;</span>] + <span class="string">&#x27;asfdsasdf&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    log_expected_error(TypeError, f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Use dict methods to mutate</span></span><br><span class="line">    <span class="comment"># Note, current verison of mypy is confused</span></span><br><span class="line">    <span class="comment"># by this and generates `&quot;Movie&quot; has no attribute &quot;clear&quot;`</span></span><br><span class="line">    m.clear()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># mypy won&#x27;t catch this KeyError from .clear()</span></span><br><span class="line">        <span class="keyword">return</span> m[<span class="string">&#x27;year&#x27;</span>] + <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    log_expected_error(KeyError, f2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Can we mix Movie and a raw dict?</span></span><br><span class="line">    d2 = <span class="built_in">dict</span>(extras=<span class="literal">True</span>, alpha=<span class="number">1234</span>, name=<span class="number">12345</span>, year=<span class="string">&#x27;1978&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># mypy will raise TypeError here</span></span><br><span class="line">    m.update(d2)</span><br><span class="line"></span><br><span class="line">    log.info(m)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Update a Movie with a Movie</span></span><br><span class="line">    m2 = Movie(name=<span class="string">&#x27;Star Wars&#x27;</span>, year=<span class="number">1977</span>)</span><br><span class="line">    new_m = Movie(name=<span class="string">&#x27;Movie Title&#x27;</span>, year=<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Both of these are proper Movie TypedDict</span></span><br><span class="line">    <span class="comment"># hence, no mypy type error</span></span><br><span class="line">    m.update(new_m)</span><br><span class="line">    log.info(m2)</span><br></pre></td></tr></table></figure>


<p>There’s a few interesting items to note.</p>
<ul>
<li><code>mypy</code> will catch assignment errors </li>
<li>The current version of <code>mypy</code> will get a bit confused with <code>dict</code> methods, such as <code>.clear()</code>. Moreover, <code>.clear()</code> will also yield <code>KeyError</code>s (related, see <code>total=False</code> keyword of the <code>TypedDict</code>)</li>
<li><code>mypy</code> will only allow merging dicts that are the same type. You can’t mix <code>TypedDict</code> and a raw dict without <code>mypy</code> raising an issue</li>
</ul>
<h2 id="Example-3-TypedDicts-total-Keyword-Argument"><a href="#Example-3-TypedDicts-total-Keyword-Argument" class="headerlink" title="Example #3: TypedDicts total Keyword Argument"></a>Example #3: TypedDicts total Keyword Argument</h2><p>There’s a <code>total</code> keyword to the <code>TypedDict</code> that communicates that the dict does not need to be completely well formed. This is particularly interesting in how the <code>mypy</code> interpets the types. </p>
<p>For example, <code>X</code> with <code>alpha</code>, <code>beta</code> and <code>gamma</code> as <code>int</code>s, will be</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">X</span>(TypedDict, total=<span class="literal">False</span>):</span><br><span class="line">    alpha:<span class="built_in">int</span></span><br><span class="line">    beta:<span class="built_in">int</span></span><br><span class="line">    gamma:<span class="built_in">int</span></span><br><span class="line"></span><br><span class="line">x:X = <span class="built_in">dict</span>()</span><br><span class="line">x[<span class="string">&#x27;alpha&#x27;</span>] = <span class="number">1</span></span><br><span class="line">x[<span class="string">&#x27;beta&#x27;</span>] = <span class="number">2</span></span><br><span class="line">x[<span class="string">&#x27;gamma&#x27;</span>] = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>Lets dive deeper using a variation of the previously defined <code>Movie</code> example using <code>total=False</code> to explore how <code>mypy</code> interprets the ‘incomplete’ data model.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Movie2</span>(TypedDict, total=<span class="literal">False</span>):</span><br><span class="line">    name:<span class="built_in">str</span></span><br><span class="line">    year:<span class="built_in">int</span></span><br><span class="line">    release_year: <span class="type">Optional</span>[<span class="built_in">int</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example_03</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Explore with defining an &#x27;incomplete&#x27; Movie data model and how</span></span><br><span class="line"><span class="string">    None/Null checking works with mypy</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    m = Movie2(name=<span class="string">&#x27;Star Wars&#x27;</span>)</span><br><span class="line">    log.info(m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># mypy will catch this</span></span><br><span class="line">        m[<span class="string">&#x27;name&#x27;</span>] = <span class="number">1234</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Use dict methods to mutate</span></span><br><span class="line">    <span class="comment"># mypy is confused by this. The error is:</span></span><br><span class="line">    <span class="comment"># `&quot;Movie&quot; has no attribute &quot;clear&quot;`</span></span><br><span class="line">    m.clear()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># mypy doesn&#x27;t catch this NPE</span></span><br><span class="line">        <span class="comment"># I don&#x27;t think it treats the type</span></span><br><span class="line">        <span class="comment"># as Optional[int]</span></span><br><span class="line">        m[<span class="string">&#x27;year&#x27;</span>] = m[<span class="string">&#x27;year&#x27;</span>] + <span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    log_expected_error(KeyError, f2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Explicit test with release_year which</span></span><br><span class="line">    <span class="comment"># is fundamentally Optional[int]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="comment"># mypy WILL catch this NPE</span></span><br><span class="line">        m[<span class="string">&#x27;release_year&#x27;</span>] = m[<span class="string">&#x27;release_year&#x27;</span>] + <span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    log_expected_error(KeyError, f3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># This works as expected and</span></span><br><span class="line">    m2 = Movie2(name=<span class="string">&#x27;Star Wars&#x27;</span>, release_year=<span class="number">2049</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This works as expected and mypy won&#x27;t raise an error</span></span><br><span class="line">    <span class="keyword">if</span> m2[<span class="string">&#x27;release_year&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        t = m2[<span class="string">&#x27;release_year&#x27;</span>] + <span class="number">10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>Finally, let’s explore how <code>isinstance</code> works with <code>TypedDict</code></p>
<h2 id="Example-4-TypedDict-and-isinstance"><a href="#Example-4-TypedDict-and-isinstance" class="headerlink" title="Example 4: TypedDict and isinstance"></a>Example 4: TypedDict and isinstance</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">example_04</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Testing isinstance&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    m = Movie(name=<span class="string">&#x27;Movie&#x27;</span>, year=<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        is_true = <span class="built_in">isinstance</span>(m, <span class="built_in">dict</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># This is a bit unexpected that this</span></span><br><span class="line">    <span class="comment"># will raise an exception at runtime</span></span><br><span class="line">    <span class="comment"># ` Cannot use isinstance() with a TypedDict type`</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">        is_true = <span class="built_in">isinstance</span>(m, Movie)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    log_expected_error(TypeError, f2)</span><br></pre></td></tr></table></figure>

<p>The important item to note here is that you can NOT use <code>isinstance</code> with <code>TypedDict</code>. Python will raise a runtime error of <code>TypeError</code>. Specifically the error you’ll see is show below.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: TypedDict does not support instance and class checks</span><br></pre></td></tr></table></figure>

<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><ul>
<li><code>TypedDict</code> + <code>mypy</code> can be valuable to help catch type errors in Python and can help with heavy dictionary-centric interfaces in your application or library</li>
<li><code>TypedDict</code> can be used in Python 3.7 using <code>mypy_extensions</code> package</li>
<li><code>TypedDict</code> can be used in Python 2.7 using <code>mypy_extensions</code> and the 2.7 ‘namedtuple-esque’ syntax style (e.g., <code>Movie = TypedDict(&#39;Movie&#39;, &#123;&#39;title&#39;:str, year:int&#125;)</code>)</li>
<li>Using the <code>total=False</code> keyword to <code>TypedDict</code> can introduce large wholes the static typechecking process yielding <code>KeyError</code>s. The keyword <code>total=False</code> should be used judiciously (if at all)</li>
<li><code>isinstance</code> should <strong>not</strong> be used with <code>TypedDict</code> as it will raise a runtime <code>TypeError</code> exception</li>
<li>Be mindful when using <code>TypeDict</code> methods such as <code>clear()</code></li>
<li><code>TypeDict</code> introduces a new (somewhat) competing data modeling alternative to <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a>, <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple">typing.NamedTuple</a>, “classic” classes and third-party libraries, such as <a target="_blank" rel="noopener" href="https://github.com/samuelcolvin/pydantic">pydantic</a> and <a target="_blank" rel="noopener" href="https://github.com/python-attrs/attrs">attrs</a>. It’s not completely clear to me how all these different competing data model abstractions models are going to age gracefully</li>
</ul>
<p>I believe <code>TypedDict</code> can be a value tool to help improve clarity of interfaces, specifically in legacy code that is a bit <strong>dictionary-mania</strong> heavy. However, for new code, I would suggest avoid using <code>TypedDict</code> in favor of the thin data models, such as <a target="_blank" rel="noopener" href="https://github.com/samuelcolvin/pydantic">pydantic</a> and <a target="_blank" rel="noopener" href="https://github.com/python-attrs/attrs">attrs</a>. </p>
<p>Best to you and your Python-ing. </p>
<p>P.S. A runnable form of the code used in the post can be found in this <a target="_blank" rel="noopener" href="https://gist.github.com/mpkocher/e123aa0613242715717d291f9df7afdd">gist</a>.</p>

        
      </div>
    </div>

  






          <div class="main-footer">
  
    © 2022  - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  
<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  
<link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">

  
<link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">


  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  
<script src="/PhotoSwipe/photoswipe.js"></script>

  
<script src="/PhotoSwipe/photoswipe-ui-default.js"></script>




<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>


<script src="/scripts/main.js"></script>


</body>
</html>
